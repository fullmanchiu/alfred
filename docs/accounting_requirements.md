# 记账功能需求文档

> **文档版本**: v2.1
> **最后更新**: 2025-01-12
> **产品经理**: 产品团队
> **目标用户**: 前后端开发团队

---

## 📊 产品概述

### 功能定位
为 ColaFit 健康管理应用添加完整的个人财务管理记账功能，帮助用户记录和管理日常收支。

### 核心价值
- 📱 **便捷记录**: 快速记录收入、支出、转账等交易
- 📊 **数据洞察**: 多维度统计分析，了解消费习惯
- 💰 **预算管理**: 设置预算，控制支出，达成理财目标
- 🏷️ **灵活分类**: 支持自定义分类和标签，满足个性化需求

---

## 🎯 功能范围

### 1. 交易管理

#### 1.1 交易类型（6种）
| 类型 | 说明 | 使用场景 |
|------|------|----------|
| 收入 (income) | 资金流入 | 工资、奖金、投资收益等 |
| 支出 (expense) | 资金流出 | 餐饮、交通、购物等日常消费 |
| 转账 (transfer) | 账户间转移 | 银行卡 → 支付宝 |
| 借入 (loan_in) | 向他人借款 | 朋友借款 |
| 借出 (loan_out) | 借钱给他人 | 借给朋友 |
| 还款 (repayment) | 归还借款 | 还之前的贷款 |

**优先级**: P0（必须支持全部6种）

#### 1.2 交易字段
- **必填**: 交易类型、金额、日期、相关账户
- **可选**: 分类、备注、标签、地点、商户、收据号
- **自动**: 创建时间、更新时间

#### 1.3 交易操作
- ✅ 创建交易记录
- ✅ 查看交易列表（支持筛选、分页）
- ✅ 查看交易详情
- ✅ 编辑交易记录（不允许修改金额和账户）
- ✅ 删除交易记录（自动恢复账户余额）
- ✅ 上传交易凭证图片

---

### 2. 账户管理

#### 2.1 账户类型
- 银行卡 (bank_card)
- 现金 (cash)
- 支付宝 (alipay)
- 微信 (wechat)
- 信用卡 (credit_card)

#### 2.2 账户信息
- 账户名称（如"招商银行"、"现金"）
- 账号（可选，如卡号后4位）
- 当前余额
- 货币类型（默认CNY）
- 图标和颜色（个性化）
- 是否默认账户

#### 2.3 账户操作
- ✅ 创建账户
- ✅ 查看账户列表和总余额
- ✅ 编辑账户信息
- ✅ 删除账户（软删除，保留历史数据）
- ✅ 设置默认账户

**优先级**: P0（核心功能）

---

### 3. 分类管理

#### 3.1 分类体系
- **类型**: 收入分类、支出分类
- **层级**: 支持父子分类（如"餐饮" → "早餐/午餐/晚餐"）
- **默认分类**: 新用户自动创建系统默认分类

#### 3.2 默认分类列表

**收入分类**:
- 工资 (attach_money, #4CAF50)
- 奖金 (card_giftcard, #FF9800)
- 投资收益 (trending_up, #009688)
- 兼职 (work, #795548)
- 礼金 (card_giftcard, #E91E63)
- 其他收入 (category, #9E9E9E)

**支出分类**:
- 餐饮 (restaurant, #FF5722)
  - 早餐、午餐、晚餐、零食、外卖
- 交通 (directions_car, #2196F3)
  - 公交、地铁、出租车、加油、停车
- 购物 (shopping_cart, #9C27B0)
  - 日用品、服装、电子产品、家电
- 居住 (home, #00BCD4)
  - 房租、水电费、燃气费、物业费
- 娱乐 (movie, #E91E63)
  - 电影、KTV、游戏、旅游
- 医疗 (local_hospital, #F44336)
  - 挂号、药品、体检、保险
- 教育 (school, #00BCD4)
  - 学费、书籍、培训、考证
- 通讯 (phone, #2196F3)
  - 话费、宽带、流量
- 人情 (card_giftcard, #FF9800)
  - 礼物、红包、请客
- 其他支出 (category, #9E9E9E)

#### 3.3 分类属性
- 分类名称
- 图标（Material Icons）
- 颜色（十六进制）
- 排序顺序
- 是否系统默认分类

#### 3.4 分类操作
- ✅ 查看分类列表（支持按类型筛选）
- ✅ 创建自定义分类
- ✅ 编辑分类（系统分类不能修改名称和类型）
- ✅ 删除分类（系统分类不能删除）
- ✅ 拖拽排序（可选）

**优先级**: P0（必须支持）

---

### 4. 预算管理

#### 4.1 预算设置
- **预算周期**: 日、周、月、年
- **预算分类**: 仅支持支出分类
- **预算金额**: 用户自定义
- **预警阈值**: 使用达到80%时触发警告

#### 4.2 预算跟踪
- 已使用金额
- 剩余金额
- 使用百分比
- 超预算警告

#### 4.3 预算操作
- ✅ 创建预算
- ✅ 查看预算列表和使用情况
- ✅ 编辑预算金额和阈值
- ✅ 删除预算

**优先级**: P1（重要功能）

---

### 5. 统计分析

#### 5.1 统计维度
- **时间维度**: 日、周、月、年
- **分类维度**: 按分类统计收支占比
- **趋势分析**: 时间序列趋势

#### 5.2 统计指标
- 总收入
- 总支出
- 结余（净储蓄）
- 分类占比
- 交易数量

#### 5.3 可视化
- 📊 分类占比饼图
- 📈 收支趋势折线图
- 💰 预算进度条

**优先级**: P1（重要功能）

---

### 6. 标签系统

#### 6.1 标签特点
- 多对多关系（一个交易可以有多个标签）
- 自定义标签名称和颜色
- 支持通过标签筛选交易

**优先级**: P2（增强功能）

---

### 7. 图片上传

#### 7.1 功能说明
- 上传交易凭证图片（小票、发票等）
- 支持批量上传
- 在交易详情页显示图片

#### 7.2 技术要求
- 支持 JPG、PNG 等常见格式
- 记录文件大小、尺寸等元信息
- 物理删除时同时删除图片文件

**优先级**: P2（增强功能）

---

### 8. 搜索功能

#### 8.1 基础搜索
- 关键词搜索：备注、商户、标签
- 实时搜索建议
- 搜索结果高亮显示关键词

#### 8.2 高级搜索
- 金额范围筛选（如：100-500元）
- 日期范围筛选（如：最近7天、本月）
- 多条件组合搜索
- 保存常用搜索条件

#### 8.3 搜索历史
- 记录最近5次搜索
- 快速重复历史搜索
- 清空搜索历史

**优先级**: P0（核心功能）

---

### 9. 数据导出

#### 9.1 导出格式
- Excel格式（.xlsx）
- CSV格式（.csv）
- JSON格式（.json，用于备份）

#### 9.2 导出选项
- 选择日期范围
- 选择分类筛选
- 包含/排除已删除交易

#### 9.3 导出内容
- 交易明细表格
- 汇总信息（总收入、总支出、结余）
- 分类占比统计
- 格式美化（合并单元格、颜色标记、数据透视表）

**优先级**: P0（核心功能）

---

### 10. 定期交易

#### 10.1 定期交易模板
- 创建定期交易规则
- 支持周期：每天/每周/每月/每年
- 自定义交易金额、分类、账户
- 设置结束条件（次数限制、结束日期、无限制）

#### 10.2 自动生成
- 后台定时任务自动生成交易
- 提前N天提醒（可配置）
- 生成历史记录查看
- 支持手动跳过某次生成

#### 10.3 常见应用场景
- 工资收入（每月固定日期）
- 房租支出（每月1号）
- 订阅服务（如Netflix、会员费）
- 定期存款

**优先级**: P0（核心功能）

---

### 11. 数据备份

#### 11.1 自动云备份
- 每日自动备份到云端
- 保留最近30天备份
- 显示备份状态和最后备份时间

#### 11.2 手动备份
- 手动触发立即备份
- 导出为JSON格式
- 包含所有数据（交易、账户、分类、预算、标签）

#### 11.3 数据恢复
- 从备份列表选择恢复
- 恢复前预览数据内容
- 恢复前确认和警告
- 支持跨设备数据迁移

**优先级**: P1（重要功能）

---

### 12. 债务追踪

#### 12.1 债款列表
- 按人名分组显示所有借贷关系
- 显示总借入金额和总借出金额
- 显示剩余未结清金额
- 按到期日期排序

#### 12.2 债款详情
- 显示所有关联的借入/借出/还款记录
- 还款进度条和剩余金额
- 到期日期和逾期提醒
- 关联交易记录快速跳转

#### 12.3 还款操作
- 支持部分还款
- 支持一次性结清
- 结清确认和归档
- 自动更新账户余额

**优先级**: P1（重要功能）

---

### 13. 账单提醒

#### 13.1 账单日历
- 可视化显示未来的账单
- 按日期显示应付金额
- 区分一次性账单和定期账单
- 已支付/未支付状态标记

#### 13.2 提醒功能
- 提前N天提醒（可配置：1天/3天/7天）
- 推送通知（移动端）
- 站内消息（Web端）
- 邮件提醒（可选）

#### 13.3 快速操作
- 从提醒直接跳转记账
- 一键标记为已支付
- 延后支付（修改到期日）

**优先级**: P1（重要功能）

---

### 14. 快速记账优化

#### 14.1 智能默认值
- 记住上次选择的分类和账户
- 根据时间推测分类（如周末可能是"娱乐"）
- 根据历史常用商户推荐分类
- 默认金额为上次相同分类的金额

#### 14.2 金额键盘优化
- 数字键盘布局优化
- 快速输入常用金额（如10、50、100）
- 支持语音输入金额
- 自动计算和验证

**优先级**: P2（体验优化）

---

### 15. 首页仪表盘

#### 15.1 今日概览
- 今日支出卡片
- 今日收入卡片
- 本月累计支出
- 距离月底剩余天数

#### 15.2 预算进度
- 本月预算使用情况
- Top 3超预算风险分类
- 预算剩余天数和日均可用额度

#### 15.3 待办提醒
- 即将到期的账单（未来7天）
- 逾期未结清的债务
- 定期交易即将生成提醒

#### 15.4 快速操作
- "记一笔"快捷按钮
- "查看统计"快捷入口
- "管理预算"快捷入口
- "查看所有待办"

**优先级**: P2（体验优化）

---

### 16. 统计增强

#### 16.1 同比/环比分析
- 本月 vs 上月对比（环比）
- 本月 vs 去年同期对比（同比）
- 显示增长率和增长金额
- 趋势图可视化

#### 16.2 月度收支预测
- 基于历史数据预测本月收支
- 根据当前进度预测月底结余
- 预测准确性提示

#### 16.3 消费习惯洞察
- 周末 vs 工作日消费对比
- 日均消费、最高单日消费
- 最常用分类Top 5
- 消费高峰时段分析

#### 16.4 异常消费提醒
- 突然的大额支出警告
- 超出历史平均水平的消费
- 异常时间段的消费（如凌晨）
- 分类消费异常增长

**优先级**: P2（体验优化）

---

## 📱 用户故事

### 故事1: 新用户首次使用
**作为**新注册用户
**我想要**快速开始记录我的第一笔支出
**以便**管理我的日常消费

**验收标准**:
- [ ] 注册后自动拥有默认分类和账户
- [ ] 可以通过明显的入口找到记账功能
- [ ] 可以成功创建第一笔交易记录

---

### 故事2: 日常记账
**作为**用户
**我想要**快速记录一笔支出
**以便**不遗忘我的消费

**验收标准**:
- [ ] 点击"记一笔"可以快速打开记账界面
- [ ] 可以选择分类、输入金额、添加备注
- [ ] 保存后可以看到交易记录

---

### 故事3: 查看统计
**作为**用户
**我想要**查看我的消费统计
**以便**了解我的消费习惯

**验收标准**:
- [ ] 可以看到总收入、总支出、结余
- [ ] 可以看到各类别的占比
- [ ] 可以选择不同的时间范围查看

---

### 故事4: 预算管理
**作为**用户
**我想要**为"餐饮"设置月度预算
**以便**控制我的餐饮支出

**验收标准**:
- [ ] 可以为餐饮分类设置预算金额
- [ ] 可以查看已使用金额和剩余金额
- [ ] 当使用超过80%时看到警告提示

---

## 🎨 UI/UX 要求

### 设计风格
- 遵循 Material 3 设计规范
- 与 ColaFit 现有界面保持一致
- 支持响应式布局（Web、平板、移动端）

### 导航入口
- 在主界面悬浮按钮菜单中添加"记一笔"选项
- 图标：`Icons.account_balance_wallet`
- 颜色：橙色

### 交互设计
- 简洁：创建交易时步骤最少化
- 智能：根据交易类型显示不同表单字段
- 反馈：操作成功/失败有明确提示

---

## 🚀 非功能性需求

### 性能要求
- 交易列表加载时间 < 1秒
- 统计数据计算时间 < 2秒
- 支持至少1000条交易记录

### 安全要求
- 所有API需要JWT认证
- 用户只能访问自己的数据
- 敏感操作（删除）需要二次确认

### 兼容性要求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 支持移动端（iOS 12+、Android 8+）

### 可扩展性
- 预留导出功能接口（CSV、Excel）
- 预留多账本支持（如需管理多个人）
- 预留多币种支持（如需外币账户）

---

## 📊 成功指标

### 功能完整性
- [ ] 支持6种交易类型
- [ ] 支持多账户管理
- [ ] 支持自定义分类
- [ ] 支持预算管理和预警

### 用户体验
- [ ] 新用户可以在5分钟内完成第一笔交易记录
- [ ] 界面简洁直观，无需查看帮助文档
- [ ] 错误提示清晰，用户知道如何修正

### 技术质量
- [ ] API响应时间 < 500ms (P95)
- [ ] 前端页面加载时间 < 2s (P95)
- [ ] 无明显bug或崩溃

---

#### v2.0 功能完整性
- [ ] 支持9个核心功能
- [ ] 搜索响应时间 < 500ms
- [ ] 导出1000条交易 < 3秒
- [ ] 首页加载时间 < 1秒
- [ ] 定期交易自动生成成功率 > 99%
- [ ] 债务追踪准确率 100%

---

## 📝 版本规划

### v1.0 - MVP（最小可行产品）✅ 已完成
**目标**: 基础记账功能可用

**功能范围**:
- ✅ 交易记录CRUD（收入、支出）
- ✅ 默认分类初始化
- ✅ 基础统计（总收入、总支出、结余）
- ✅ 导航入口

**实际完成**: 2025-01-08

---

### v2.0 - 功能增强 🔄 进行中（77%完成）
**目标**: 完整财务管理功能

**新增功能**:
- ✅ 完整账户管理（已完成）
- ✅ 6种交易类型支持（已完成）
- ⏳ 自定义分类编辑（部分完成 - 仅模型和API）
- ⏳ 预算管理和预警（部分完成 - 仅模型和API）

**实际完成**: 2025-01-07（已完成部分）

**预计完成**: 2025-01-10（待完成UI）

---

### v2.0 - 完整功能升级 🚀 进行中（2025-01-12开始）
**目标**: 打造个人用户的专业记账工具

**新增功能** (9个核心功能):
- ✅ 搜索功能 [P0] - 关键词搜索、高级搜索、搜索历史
- ✅ 数据导出 [P0] - Excel/CSV导出、日期范围选择、汇总信息
- ✅ 定期交易 [P0] - 定期交易模板、自动生成、提前提醒
- ✅ 数据备份 [P1] - 云备份、手动备份、数据恢复
- ✅ 债务追踪 [P1] - 欠款关系、还款进度、结清确认
- ✅ 账单提醒 [P1] - 账单日历、提前提醒、快速记账
- ✅ 快速记账优化 [P2] - 记住上次选择、智能默认值
- ✅ 首页仪表盘 [P2] - 今日支出、预算进度、待办提醒
- ✅ 统计增强 [P2] - 同比环比、消费洞察、异常提醒

**预计工作量**: 15-20天

**技术亮点**:
- 定时任务：自动生成定期交易
- 通知推送：账单到期提醒
- 数据导出：Excel/CSV格式
- 搜索优化：全文索引

**预计完成**: 2025-01-30

---

### v3.0 - 高级特性 ❌ 未开始
**目标**: 提升用户体验

**新增功能**:
- ❌ 标签系统
- ❌ 图片上传
- ❌ 高级统计图表

**预计上线**: 后续版本

---

## 🤝 团队协作

### 前端团队
- 参考: `/ColaFit/docs/ACCOUNTING_API_SPEC.md`
- 参考: `/docs/accounting_todos.md`
- 重点关注: UI实现、状态管理、API对接

### 后端团队
- 参考: `/Alfred/docs/api/accounting_feature.md`
- 参考: `/docs/accounting_todos.md`
- 重点关注: API实现、数据一致性、性能优化

### 产品经理
- 本文档作为需求基准
- 待办事项文档跟踪进度
- 协调前后端优先级冲突

---

## 📞 联系方式

如有需求疑问或需要澄清，请联系产品团队。

**文档维护**: 产品经理
**最后审核**: 2025-01-12
